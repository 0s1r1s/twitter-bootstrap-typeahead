!function(a){"use strict";var b=function(b,c){this.$element=a(b);this.options=a.extend(true,{},a.fn.typeahead.defaults,c);this.$menu=a(this.options.menu).appendTo("body");this.shown=false;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.matcher=this.options.matcher||this.matcher;this.select=this.options.select||this.select;this.render=this.options.render||this.render;this.source=this.options.source||this.source;if(!this.source.length){var d=this.options.ajax;if(typeof d==="string"){this.ajax=a.extend({},a.fn.typeahead.defaults.ajax,{url:d})}else{this.ajax=a.extend({},a.fn.typeahead.defaults.ajax,d)}if(!this.ajax.url){this.ajax=null}}this.listen()};b.prototype={constructor:b,ajaxer:function(){var b=this,c=this.$element.val();if(c===this.query){return this}this.query=c;if(this.ajax.timerId){clearTimeout(this.ajax.timerId);this.ajax.timerId=null}if(!c||c.length<this.ajax.triggerLength){if(this.ajax.xhr){this.ajax.xhr.abort();this.ajax.xhr=null;this.ajaxToggleLoadClass(false)}return this.shown?this.hide():this}this.ajax.timerId=setTimeout(a.proxy(b.ajaxExecute(c),this),this.ajax.timeout);return this},ajaxExecute:function(b){this.ajaxToggleLoadClass(true);if(this.ajax.xhr)this.ajax.xhr.abort();var c=this.ajax.preDispatch?this.ajax.preDispatch(b):{query:b};var d=this.ajax.method=="post"?a.post:a.get;this.ajax.xhr=d(this.ajax.url,c,a.proxy(this.ajaxLookup,this));this.ajax.timerId=null},ajaxLookup:function(a){var b=this,c;b.ajaxToggleLoadClass(false);if(!b.ajax.xhr)return;if(b.ajax.preProcess){a=b.ajax.preProcess(a)}b.ajax.data=a;c=this.grepper(this.ajax.data);if(!c.length){return this.shown?this.hide():this}this.ajax.xhr=null;return this.render(c.slice(0,this.options.items)).show()},ajaxToggleLoadClass:function(a){if(!this.ajax.loadingClass)return;this.$element.toggleClass(this.ajax.loadingClass,a)},lookup:function(a){var b=this,c;if(b.ajax){b.ajaxer()}else{b.query=b.$element.val();if(!b.query){return b.shown?b.hide():b}c=this.grepper(b.source);if(!c.length){return b.shown?b.hide():b}return b.render(c.slice(0,b.options.items)).show()}},grepper:function(b){var c=this,d;if(!b[0].hasOwnProperty(c.options.display)){console.log('typeahead.lookup(): source object has no property named "'+c.options.display+'"');return null}d=a.grep(b,function(a){return c.matcher(a[c.options.display])});return this.sorter(d)},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){var b=this,c=[],d=[],e=[],f;while(f=a.shift()){if(!f[b.options.display].toLowerCase().indexOf(this.query.toLowerCase())){c.push(f)}else if(~f[b.options.display].indexOf(this.query)){d.push(f)}else{e.push(f)}}return c.concat(d,e)},show:function(){var b=a.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:b.top+b.height,left:b.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},highlighter:function(a){var b=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+b+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;b=a(b).map(function(b,d){b=a(c.options.item).attr("data-value",d[c.options.val]);b.find("a").html(c.highlighter(d[c.options.display]));return b[0]});b.first().addClass("active");this.$menu.html(b);return this},select:function(){var a=this.$menu.find(".active");this.$element.val(a.text()).change();this.options.itemSelected(a,a.attr("data-value"),a.text());return this.hide()},next:function(b){var c=this.$menu.find(".active").removeClass("active");var d=c.next();if(!d.length){d=a(this.$menu.find("li")[0])}d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active");var c=b.prev();if(!c.length){c=this.$menu.find("li").last()}c.addClass("active")},listen:function(){this.$element.on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this));if(a.browser.webkit||a.browser.msie){this.$element.on("keydown",a.proxy(this.keypress,this))}this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this))},keyup:function(a){a.stopPropagation();a.preventDefault();switch(a.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown){return}this.select();break;case 27:this.hide();break;default:this.lookup()}},keypress:function(a){a.stopPropagation();if(!this.shown){return}switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault();this.prev();break;case 40:a.preventDefault();this.next();break}},blur:function(a){var b=this;a.stopPropagation();a.preventDefault();setTimeout(function(){b.hide()},150)},click:function(a){a.stopPropagation();a.preventDefault();this.select()},mouseenter:function(b){this.$menu.find(".active").removeClass("active");a(b.currentTarget).addClass("active")}};a.fn.typeahead=function(c){return this.each(function(){var d=a(this),e=d.data("typeahead"),f=typeof c==="object"&&c;if(!e){d.data("typeahead",e=new b(this,f))}if(typeof c==="string"){e[c]()}})};a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',display:"name",val:"id",itemSelected:function(){},ajax:{url:null,timeout:300,method:"post",triggerLength:3,loadingClass:null,displayField:null,preDispatch:null,preProcess:null}};a.fn.typeahead.Constructor=b;a(function(){a("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);if(c.data("typeahead")){return}b.preventDefault();c.typeahead(c.data())})})}(window.jQuery)